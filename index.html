<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reforma Segura - Monitoreo en Tiempo Real</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            color: white;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
            background: #000000;
        }

        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: 
                radial-gradient(circle at 20% 80%, rgba(220, 38, 38, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(220, 38, 38, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(239, 68, 68, 0.05) 0%, transparent 50%),
                linear-gradient(135deg, #000000 0%, #0a0a0a 50%, #000000 100%);
        }

        .floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .floating-element {
            position: absolute;
            background: linear-gradient(45deg, #dc2626, #ef4444);
            border-radius: 50%;
            filter: blur(40px);
            opacity: 0.3;
            animation: floatElement 15s infinite linear;
        }

        .floating-element:nth-child(1) {
            width: 300px;
            height: 300px;
            top: 10%;
            left: 10%;
            animation-delay: 0s;
            animation-duration: 20s;
        }

        .floating-element:nth-child(2) {
            width: 200px;
            height: 200px;
            top: 60%;
            left: 80%;
            animation-delay: 5s;
            animation-duration: 25s;
        }

        .floating-element:nth-child(3) {
            width: 400px;
            height: 400px;
            top: 80%;
            left: 20%;
            animation-delay: 10s;
            animation-duration: 30s;
        }

        @keyframes floatElement {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 0.2;
            }
            25% {
                transform: translate(100px, 50px) scale(1.1);
                opacity: 0.3;
            }
            50% {
                transform: translate(200px, -30px) scale(0.9);
                opacity: 0.25;
            }
            75% {
                transform: translate(50px, -80px) scale(1.05);
                opacity: 0.35;
            }
            100% {
                transform: translate(0, 0) scale(1);
                opacity: 0.2;
            }
        }

        .grid-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background-image: 
                linear-gradient(rgba(220, 38, 38, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(220, 38, 38, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
        }

        @keyframes gridMove {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 50px 50px;
            }
        }
        
        #map-container {
            height: 60vh;
            width: 100%;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: #1a1a1a;
        }
        
        .card {
            background: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #dc2626, #ef4444);
            border-radius: 16px 16px 0 0;
        }
        
        .affected-street {
            position: relative;
            padding-left: 20px;
        }
        
        .affected-street::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background-color: #ef4444;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .alert-banner {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.2) 0%, rgba(239, 68, 68, 0.1) 100%);
            border: 1px solid rgba(220, 38, 38, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .glow {
            box-shadow: 0 0 30px rgba(220, 38, 38, 0.3);
        }

        .title-glow {
            text-shadow: 0 0 30px rgba(239, 68, 68, 0.5);
        }

        /* Estilos para pines corregidos */
        .custom-pin {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }
        
        .pin-pulse {
            animation: pinPulse 2s infinite;
        }
        
        @keyframes pinPulse {
            0% {
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7);
            }
            70% {
                box-shadow: 0 0 0 12px rgba(220, 38, 38, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0);
            }
        }

        .pulse-dot {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }
    </style>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="p-4 md:p-8 min-h-screen">
    <!-- Fondo -->
    <div class="grid-pattern"></div>
    <div class="background-animation"></div>
    <div class="floating-elements">
        <div class="floating-element"></div>
        <div class="floating-element"></div>
        <div class="floating-element"></div>
    </div>

    <div class="max-w-7xl mx-auto relative z-10">
        <header class="mb-8 text-center">
            <h1 class="text-4xl md:text-6xl font-extrabold bg-gradient-to-r from-red-400 to-red-600 bg-clip-text text-transparent mt-4 title-glow">
                Reforma Segura
            </h1>
            <p class="text-lg md:text-xl text-gray-300 mt-2 max-w-3xl mx-auto">
                Monitoreo en Tiempo Real
                <span id="status-container" class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-red-600 text-white ml-2">
                    <i data-lucide="alert-triangle" class="w-3 h-3 mr-1"></i>
                    <span id="status-text">Sistema Activo</span>
                </span>
            </p>
            <div class="mt-4">
                <div class="text-lg bg-gray-900 rounded-lg px-4 py-2 inline-block border border-gray-700" id="real-time-clock">--:--:--</div>
            </div>
        </header>

        <!-- Banner informativo -->
        <div class="card p-6 mb-6 alert-banner glow">
            <div class="flex items-start">
                <div class="mr-4 mt-1">
                    <i data-lucide="alert-triangle" class="w-8 h-8 text-red-400"></i>
                </div>
                <div class="flex-1">
                    <h2 class="text-xl font-bold mb-2">🚨 Megamarcha de Transportistas ACTIVA - Miércoles 29 de octubre de 2025</h2>
                    <p class="mb-3 text-gray-200">La <strong class="text-red-300">Fuerza Amplia de Transportistas (FAT)</strong> está realizando una megamarcha y bloqueos masivos exigiendo un aumento en las tarifas del transporte público.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h3 class="font-semibold mb-2 text-red-300">Detalles de la manifestación:</h3>
                            <ul class="text-sm space-y-1 text-gray-300">
                                <li><strong>Horario:</strong> 14:00 - 19:00 horas</li>
                                <li><strong>Recorrido:</strong> Del Monumento a la Revolución al Zócalo Capitalino</li>
                                <li><strong>Inicio:</strong> 15:00 horas desde el Monumento a la Revolución</li>
                                <li><strong>Organizador:</strong> Movimiento "Recuperemos el Régimen de Jubilaciones y Pensiones"</li>
                                <li><strong>Estado actual:</strong> <span class="text-red-300 font-bold">EN CURSO</span></li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="font-semibold mb-2 text-red-300">Vialidades afectadas:</h3>
                            <ul class="text-sm space-y-1 text-gray-300">
                                <li class="affected-street">Avenida de la República</li>
                                <li class="affected-street">Paseo de la Reforma</li>
                                <li class="affected-street">Calle Balderas</li>
                                <li class="affected-street">Avenida Juárez</li>
                                <li class="affected-street">Eje Central Lázaro Cárdenas</li>
                                <li class="affected-street">Avenida Hidalgo</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-3 bg-red-500/20 rounded-lg border border-red-500">
                        <h3 class="font-semibold mb-1 text-red-300">Recomendaciones:</h3>
                        <p class="text-sm text-gray-200">Evite el uso de vehículos particulares en las zonas afectadas. Utilice rutas alternas como Periférico, Circuito Interior o Viaducto Miguel Alemán.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tarjetas de estado -->
        <div class="card p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-white flex items-center">
                <i data-lucide="activity" class="w-6 h-6 mr-2 text-red-400"></i>
                Estado del Área - Tiempo Real
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-gradient-to-br from-red-500 to-red-600 p-4 rounded-xl text-white">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm opacity-90">Incidentes Activos</p>
                            <p class="text-2xl font-bold" id="active-count">12</p>
                        </div>
                        <i data-lucide="alert-triangle" class="w-8 h-8"></i>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-orange-500 to-orange-600 p-4 rounded-xl text-white">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm opacity-90">Reportes Ciudadanos</p>
                            <p class="text-2xl font-bold" id="reports-count">24</p>
                        </div>
                        <i data-lucide="users" class="w-8 h-8"></i>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-4 rounded-xl text-white">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm opacity-90">Fuentes Activas</p>
                            <p class="text-2xl font-bold" id="sources-count">3</p>
                        </div>
                        <i data-lucide="radio" class="w-8 h-8"></i>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-green-500 to-green-600 p-4 rounded-xl text-white">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm opacity-90">Última Actualización</p>
                            <p class="text-lg font-bold" id="last-update">--:--</p>
                        </div>
                        <i data-lucide="clock" class="w-8 h-8"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mapa -->
        <div id="map-container" class="mb-8">
            <div id="map" class="w-full h-full"></div>
        </div>

        <!-- Reportes -->
        <section class="card p-6">
            <h2 class="text-2xl font-semibold mb-4 text-white flex items-center">
                <i data-lucide="alert-circle" class="w-6 h-6 mr-2 text-orange-400"></i>
                Reportes Recientes
                <span class="absolute top-0 right-0 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs -mt-2 -mr-2">12</span>
            </h2>
            <div id="reports-list" class="space-y-4">
                <!-- Los reportes se cargarán dinámicamente -->
            </div>
        </section>
    </div>

    <script>
        // ===== CONFIGURACIÓN =====
        const ANGEL_COORDS = [19.4269, -99.1678];
        let map;

        // ===== DATOS DE INCIDENTES CON COORDENADAS VERIFICADAS =====
        const INCIDENTES = [
            // PUNTO CENTRAL
            {
                coords: [19.4269, -99.1678],
                title: "Ángel de la Independencia",
                description: "Punto focal de la megamarcha - Bloqueo total en glorieta",
                type: "central",
                severity: "high",
                source: "Movilidad CDMX"
            },

            // AVENIDAS AFECTADAS - Puntos estratégicos
            {
                coords: [19.4370, -99.1540],
                title: "Avenida de la República - Monumento a la Revolución",
                description: "Punto de inicio de la marcha - Concentración de 300+ unidades",
                type: "manifestacion",
                severity: "high",
                source: "Policía de Tránsito"
            },
            {
                coords: [19.4325, -99.1510],
                title: "Paseo de la Reforma - Glorieta de la Palma",
                description: "Marcha avanzando - Tránsito completamente detenido",
                type: "manifestacion", 
                severity: "high",
                source: "Reporte Ciudadano"
            },
            {
                coords: [19.4310, -99.1485],
                title: "Calle Balderas",
                description: "Bloqueo total - Vialidad cerrada en ambos sentidos",
                type: "manifestacion",
                severity: "high",
                source: "Waze"
            },
            {
                coords: [19.4320, -99.1480],
                title: "Avenida Juárez - Alameda Central",
                description: "Segundo contingente - Acceso a Centro Histórico bloqueado",
                type: "manifestacion",
                severity: "high", 
                source: "Google Maps"
            },
            {
                coords: [19.4315, -99.1470],
                title: "Eje Central Lázaro Cárdenas",
                description: "Bloqueo total - Desvíos establecidos por autoridades",
                type: "manifestacion",
                severity: "high",
                source: "Secretaría de Movilidad"
            },
            {
                coords: [19.4355, -99.1475],
                title: "Avenida Hidalgo - Bellas Artes",
                description: "Contingente avanzando - Tránsito muy lento",
                type: "manifestacion",
                severity: "medium",
                source: "Noticiero Local"
            },

            // INCIDENTES DE TRÁFICO
            {
                coords: [19.4245, -99.1650],
                title: "Zona Rosa - Insurgentes",
                description: "Congestionamiento severo por desvíos de manifestación",
                type: "trafico",
                severity: "medium",
                source: "C5 CDMX"
            },
            {
                coords: [19.4238, -99.1620],
                title: "Condesa - Avenida Michoacán",
                description: "Tráfico pesado por vehículos buscando rutas alternas",
                type: "trafico",
                severity: "medium",
                source: "Twitter CDMX"
            },
            {
                coords: [19.4290, -99.1600],
                title: "Roma Norte - Calle Oaxaca",
                description: "Congestionamiento por cierre de Reforma",
                type: "trafico",
                severity: "medium",
                source: "Reporte Ciudadano"
            },
            {
                coords: [19.4340, -99.1440],
                title: "Centro Histórico - Eje Central",
                description: "Tránsito lento hacia Zócalo por marcha",
                type: "trafico",
                severity: "medium",
                source: "Google Maps"
            },
            {
                coords: [19.4200, -99.1700],
                title: "Nápoles - Avenida de los Insurgentes",
                description: "Aumento de tráfico por desvíos establecidos",
                type: "trafico",
                severity: "low",
                source: "Waze"
            }
        ];

        // ===== INICIALIZACIÓN DEL MAPA =====
        function initializeMap() {
            const mapElement = document.getElementById('map');
            if (!mapElement) return;

            // Crear mapa centrado en el Ángel
            map = L.map('map').setView(ANGEL_COORDS, 15);
            
            // Añadir capa de tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);

            // Crear pines personalizados por tipo
            function createPin(color, size = 40) {
                return L.divIcon({
                    html: `
                        <div class="custom-pin pin-pulse" style="width: ${size}px; height: ${size}px; background: ${color};">
                            <svg width="${size * 0.5}" height="${size * 0.5}" viewBox="0 0 24 24" fill="white">
                                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                            </svg>
                        </div>
                    `,
                    iconSize: [size, size],
                    iconAnchor: [size/2, size],
                    popupAnchor: [0, -size]
                });
            }

            // Definir pines por tipo
            const pinTypes = {
                central: createPin('#3b82f6', 50),      // Azul - Punto central
                manifestacion: createPin('#dc2626', 40), // Rojo - Manifestaciones
                trafico: createPin('#f59e0b', 35)       // Naranja - Tráfico
            };

            // Añadir todos los marcadores
            INCIDENTES.forEach(incidente => {
                const pin = pinTypes[incidente.type];
                
                L.marker(incidente.coords, { icon: pin })
                    .addTo(map)
                    .bindPopup(`
                        <div class="p-3 min-w-[280px]">
                            <h3 class="font-bold text-lg mb-2">${incidente.title}</h3>
                            <p class="text-sm text-gray-700 mb-3">${incidente.description}</p>
                            <div class="space-y-1 text-xs">
                                <div class="flex justify-between">
                                    <span class="font-semibold">Estado:</span>
                                    <span class="${
                                        incidente.severity === 'high' ? 'text-red-500 font-bold' : 
                                        incidente.severity === 'medium' ? 'text-orange-500' : 'text-yellow-500'
                                    }">
                                        ${incidente.severity === 'high' ? 'ALTA' : incidente.severity === 'medium' ? 'MEDIA' : 'BAJA'}
                                    </span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-semibold">Fuente:</span>
                                    <span>${incidente.source}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-semibold">Actualizado:</span>
                                    <span>${new Date().toLocaleTimeString()}</span>
                                </div>
                            </div>
                        </div>
                    `);
            });

            // Añadir círculo de área de monitoreo (1.5 km)
            L.circle(ANGEL_COORDS, {
                color: '#3b82f6',
                fillColor: '#3b82f6',
                fillOpacity: 0.1,
                radius: 1500
            }).addTo(map).bindPopup('Área de monitoreo: 1.5 km alrededor del Ángel');

            console.log(`Mapa inicializado con ${INCIDENTES.length} incidentes`);
        }

        // ===== ACTUALIZAR LISTA DE REPORTES =====
        function updateReportsList() {
            const reportsList = document.getElementById('reports-list');
            if (!reportsList) return;

            reportsList.innerHTML = INCIDENTES.map(incidente => `
                <div class="p-4 rounded-lg border-l-4 ${
                    incidente.severity === 'high' ? 'border-red-500 bg-red-500/10' : 
                    incidente.severity === 'medium' ? 'border-orange-500 bg-orange-500/10' : 
                    'border-yellow-500 bg-yellow-500/10'
                }">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <h3 class="font-semibold text-lg">${incidente.title}</h3>
                                <span class="ml-2 px-2 py-1 ${
                                    incidente.severity === 'high' ? 'bg-red-500' : 
                                    incidente.severity === 'medium' ? 'bg-orange-500' : 
                                    'bg-yellow-500'
                                } text-white rounded-full text-xs font-medium">
                                    ${incidente.source}
                                </span>
                            </div>
                            <p class="text-gray-300">${incidente.description}</p>
                            <div class="flex items-center mt-2 text-sm text-gray-400">
                                <i data-lucide="clock" class="w-4 h-4 mr-1"></i>
                                <span>${new Date().toLocaleTimeString('es-MX')}</span>
                                <span class="mx-2">•</span>
                                <i data-lucide="map-pin" class="w-4 h-4 mr-1"></i>
                                <span class="capitalize">${incidente.type}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            // Actualizar contadores
            document.getElementById('active-count').textContent = INCIDENTES.length;
            document.getElementById('reports-count').textContent = INCIDENTES.length;
        }

        // ===== FUNCIONES DE INTERFAZ =====
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('es-MX');
            
            document.getElementById('real-time-clock').textContent = timeString;
            document.getElementById('last-update').textContent = timeString;
        }

        // ===== INICIALIZACIÓN DE LA APLICACIÓN =====
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar íconos
            lucide.createIcons();
            
            // Inicializar mapa
            initializeMap();
            
            // Actualizar lista de reportes
            updateReportsList();
            
            // Inicializar reloj
            updateClock();
            setInterval(updateClock, 1000);
            
            console.log('Reforma Segura - Sistema completamente inicializado');
        });
    </script>
</body>
</html>
