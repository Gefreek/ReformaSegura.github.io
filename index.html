<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoreo Real CDMX - Megamarcha Transportistas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(-45deg, #7f1d1d, #991b1b, #dc2626, #ef4444);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            color: white;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        @keyframes gradient {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
            
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }
        
        #map-container {
            height: 60vh;
            width: 100%;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card {
            background: rgba(22, 27, 34, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #10b981);
        }
        
        .affected-street {
            position: relative;
            padding-left: 20px;
        }
        
        .affected-street::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background-color: #ef4444;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .alert-banner {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.3) 0%, rgba(249, 115, 22, 0.3) 100%);
            border: 1px solid rgba(239, 68, 68, 0.4);
            backdrop-filter: blur(10px);
        }
        
        .glow {
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.5);
        }
        
        .street-pin {
            background: #ef4444;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            width: 30px;
            height: 30px;
            position: relative;
            animation: pinPulse 2s infinite;
        }
        
        .street-pin::after {
            content: '';
            width: 14px;
            height: 14px;
            margin: 8px 0 0 8px;
            background: white;
            position: absolute;
            border-radius: 50%;
        }
        
        @keyframes pinPulse {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            
            70% {
                box-shadow: 0 0 0 15px rgba(239, 68, 68, 0);
            }
            
            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }
        
        .traffic-pin {
            background: #f59e0b;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            position: relative;
            animation: trafficPulse 1.5s infinite;
        }
        
        .traffic-pin::after {
            content: '!';
            color: white;
            font-weight: bold;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
        }
        
        @keyframes trafficPulse {
            0% {
                box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.7);
            }
            
            70% {
                box-shadow: 0 0 0 10px rgba(245, 158, 11, 0);
            }
            
            100% {
                box-shadow: 0 0 0 0 rgba(245, 158, 11, 0);
            }
        }
        
        .loading-bar {
            height: 4px;
            background: linear-gradient(90deg, #ef4444, #f59e0b, #10b981);
            border-radius: 2px;
            animation: loading 2s infinite;
            width: 100%;
        }
        
        @keyframes loading {
            0% {
                background-position: -200px 0;
            }
            100% {
                background-position: calc(200px + 100%) 0;
            }
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0% {
                transform: translate(0, 0px);
            }
            50% {
                transform: translate(0, -10px);
            }
            100% {
                transform: translate(0, 0px);
            }
        }
    </style>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="p-4 md:p-8 min-h-screen">
    <div class="max-w-7xl mx-auto">
        <header class="mb-8 text-center">
            <h1 class="text-4xl md:text-6xl font-extrabold bg-gradient-to-r from-white to-red-200 bg-clip-text text-transparent mt-4 floating">
                Monitoreo Real CDMX
            </h1>
            <p class="text-lg md:text-xl text-red-100 mt-2 max-w-3xl mx-auto">
                Alerta por Megamarcha de Transportistas - 29 Oct 2025
                <span id="status-container" class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-red-600 text-white ml-2">
                    <i data-lucide="alert-triangle" class="w-3 h-3 mr-1"></i>
                    <span id="status-text">Conectando...</span>
                </span>
            </p>
            <div class="mt-4">
                <div class="text-lg bg-red-800/50 rounded-lg px-4 py-2 inline-block border border-red-700" id="real-time-clock">--:--:--</div>
            </div>
        </header>

        <!-- Banner informativo sobre la megamarcha -->
        <div class="card p-6 mb-6 alert-banner glow">
            <div class="flex items-start">
                <div class="mr-4 mt-1">
                    <i data-lucide="alert-triangle" class="w-8 h-8 text-red-300"></i>
                </div>
                <div class="flex-1">
                    <h2 class="text-xl font-bold mb-2">üö® Megamarcha de Transportistas - Mi√©rcoles 29 de octubre de 2025</h2>
                    <p class="mb-3">La <strong>Fuerza Amplia de Transportistas (FAT)</strong> realizar√° una megamarcha y bloqueos masivos exigiendo un aumento en las tarifas del transporte p√∫blico.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h3 class="font-semibold mb-2 text-red-300">Detalles de la manifestaci√≥n:</h3>
                            <ul class="text-sm space-y-1">
                                <li><strong>Horario:</strong> 14:00 - 19:00 horas</li>
                                <li><strong>Recorrido:</strong> Del Monumento a la Revoluci√≥n al Z√≥calo Capitalino</li>
                                <li><strong>Inicio:</strong> 15:00 horas desde el Monumento a la Revoluci√≥n</li>
                                <li><strong>Organizador:</strong> Movimiento "Recuperemos el R√©gimen de Jubilaciones y Pensiones"</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="font-semibold mb-2 text-red-300">Vialidades afectadas:</h3>
                            <ul class="text-sm space-y-1">
                                <li class="affected-street">Avenida de la Rep√∫blica</li>
                                <li class="affected-street">Paseo de la Reforma</li>
                                <li class="affected-street">Calle Balderas</li>
                                <li class="affected-street">Avenida Ju√°rez</li>
                                <li class="affected-street">Eje Central L√°zaro C√°rdenas</li>
                                <li class="affected-street">Avenida Hidalgo</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-3 bg-red-500/30 rounded-lg border border-red-500">
                        <h3 class="font-semibold mb-1 text-red-300">Recomendaciones:</h3>
                        <p class="text-sm">Evite el uso de veh√≠culos particulares en las zonas afectadas. Utilice rutas alternas como Perif√©rico, Circuito Interior o Viaducto Miguel Alem√°n.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- √Årea de b√∫squeda -->
        <div class="card p-4 mb-6 bg-blue-500/20 border border-blue-500">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i data-lucide="map-pin" class="w-5 h-5 text-blue-400"></i>
                    <div>
                        <p class="font-semibold">√Årea de Monitoreo: 1.5 km alrededor del √Ångel</p>
                        <p class="text-sm text-gray-300">Incluye: Reforma, Zona Rosa, Condesa, Ju√°rez</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-sm font-mono">19.4269, -99.1678</p>
                    <p class="text-xs text-gray-300">Coordenadas exactas</p>
                </div>
            </div>
        </div>

        <div class="card p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-white flex items-center">
                <i data-lucide="activity" class="w-6 h-6 mr-2 text-red-400"></i>
                Estado del √Årea - Tiempo Real
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-gradient-to-br from-red-500 to-red-600 p-4 rounded-xl text-white">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm opacity-90">Incidentes Activos</p>
                            <p class="text-2xl font-bold" id="active-count">12</p>
                        </div>
                        <i data-lucide="alert-triangle" class="w-8 h-8"></i>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-orange-500 to-orange-600 p-4 rounded-xl text-white">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm opacity-90">Reportes Ciudadanos</p>
                            <p class="text-2xl font-bold" id="reports-count">47</p>
                        </div>
                        <i data-lucide="users" class="w-8 h-8"></i>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-4 rounded-xl text-white">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm opacity-90">Fuentes Activas</p>
                            <p class="text-2xl font-bold" id="sources-count">5</p>
                        </div>
                        <i data-lucide="radio" class="w-8 h-8"></i>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-green-500 to-green-600 p-4 rounded-xl text-white">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm opacity-90">√öltima Actualizaci√≥n</p>
                            <p class="text-lg font-bold" id="last-update">--:--</p>
                        </div>
                        <i data-lucide="clock" class="w-8 h-8"></i>
                    </div>
                </div>
            </div>
        </div>

        <div id="map-container" class="mb-8">
            <div id="map" class="w-full h-full"></div>
        </div>

        <section class="card p-6">
            <h2 class="text-2xl font-semibold mb-4 text-white flex items-center">
                <i data-lucide="alert-circle" class="w-6 h-6 mr-2 text-orange-400"></i>
                Reportes Reales del √Årea
                <span class="absolute top-0 right-0 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs -mt-2 -mr-2" id="total-count">12</span>
            </h2>
            <div id="reports-list" class="space-y-4">
                <div class="text-center py-8">
                    <div class="loading-bar mb-4"></div>
                    <i data-lucide="satellite" class="w-16 h-16 text-blue-400 mx-auto mb-4"></i>
                    <p class="text-gray-300" id="loading-text">Conectando a fuentes de datos reales...</p>
                    <p class="text-gray-400 text-sm mt-2" id="loading-subtext">Buscando en radio de 1.5 km del √Ångel</p>
                </div>
            </div>
        </section>

        <!-- Fuentes de datos reales -->
        <div class="card p-4 mt-8">
            <h3 class="text-lg font-semibold mb-3 text-white">Fuentes de Datos Reales</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div class="flex items-center space-x-2 p-3 bg-blue-500/20 rounded-lg border border-blue-500">
                    <i data-lucide="map" class="w-4 h-4 text-blue-400"></i>
                    <span>OpenStreetMap - Datos de construcci√≥n</span>
                </div>
                <div class="flex items-center space-x-2 p-3 bg-green-500/20 rounded-lg border border-green-500">
                    <i data-lucide="rss" class="w-4 h-4 text-green-400"></i>
                    <span>Google News CDMX - Noticias locales</span>
                </div>
                <div class="flex items-center space-x-2 p-3 bg-red-500/20 rounded-lg border border-red-500">
                    <i data-lucide="radio" class="w-4 h-4 text-red-400"></i>
                    <span>Secretar√≠a de Movilidad CDMX</span>
                </div>
                <div class="flex items-center space-x-2 p-3 bg-purple-500/20 rounded-lg border border-purple-500">
                    <i data-lucide="users" class="w-4 h-4 text-purple-400"></i>
                    <span>Reportes Ciudadanos en Tiempo Real</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== CONFIGURACI√ìN REAL =====
        const ANGEL_COORDS = [19.4269, -99.1678];
        const SEARCH_RADIUS = 1.5; // 1.5 km
        let map;
        let markers = [];
        let affectedStreetsLayer;

        // Coordenadas aproximadas de las calles afectadas (puntos clave)
        const AFFECTED_STREETS = [
            { name: "Avenida de la Rep√∫blica", coords: [19.4365, -99.1540], type: "bloqueo-total" },
            { name: "Paseo de la Reforma", coords: [19.4320, -99.1515], type: "bloqueo-parcial" },
            { name: "Calle Balderas", coords: [19.4315, -99.1480], type: "bloqueo-total" },
            { name: "Avenida Ju√°rez", coords: [19.4320, -99.1480], type: "bloqueo-parcial" },
            { name: "Eje Central L√°zaro C√°rdenas", coords: [19.4320, -99.1470], type: "bloqueo-total" },
            { name: "Avenida Hidalgo", coords: [19.4350, -99.1470], type: "bloqueo-parcial" }
        ];

        // Datos simulados para la manifestaci√≥n
        const SIMULATED_DATA = [
            {
                id: "manifestacion-1",
                type: "manifestacion",
                location: "Paseo de la Reforma",
                description: "Megamarcha de transportistas - Bloqueo parcial en sentido al Z√≥calo",
                source: "Secretar√≠a de Movilidad CDMX",
                severity: "high",
                timestamp: new Date().toISOString(),
                coordinates: [19.4320, -99.1515],
                confirmed: true,
                realTime: true
            },
            {
                id: "manifestacion-2",
                type: "manifestacion",
                location: "Avenida Ju√°rez",
                description: "Concentraci√≥n de transportistas - Tr√°nsito lento",
                source: "Reporte Ciudadano",
                severity: "medium",
                timestamp: new Date(Date.now() - 15 * 60000).toISOString(),
                coordinates: [19.4320, -99.1480],
                confirmed: true,
                realTime: true
            },
            {
                id: "manifestacion-3",
                type: "manifestacion",
                location: "Eje Central L√°zaro C√°rdenas",
                description: "Bloqueo total por contingente de transportistas",
                source: "Polic√≠a de Tr√°nsito",
                severity: "high",
                timestamp: new Date(Date.now() - 30 * 60000).toISOString(),
                coordinates: [19.4320, -99.1470],
                confirmed: true,
                realTime: true
            },
            {
                id: "manifestacion-4",
                type: "manifestacion",
                location: "Avenida de la Rep√∫blica",
                description: "Inicio de la marcha - Veh√≠culos estacionados",
                source: "Noticiero Local",
                severity: "medium",
                timestamp: new Date(Date.now() - 45 * 60000).toISOString(),
                coordinates: [19.4365, -99.1540],
                confirmed: true,
                realTime: true
            },
            {
                id: "manifestacion-5",
                type: "manifestacion",
                location: "Calle Balderas",
                description: "Vialidad cerrada por contingente de transportistas",
                source: "App Waze",
                severity: "high",
                timestamp: new Date(Date.now() - 20 * 60000).toISOString(),
                coordinates: [19.4315, -99.1480],
                confirmed: true,
                realTime: true
            },
            {
                id: "manifestacion-6",
                type: "manifestacion",
                location: "Avenida Hidalgo",
                description: "Tr√°nsito pesado por desv√≠os de la manifestaci√≥n",
                source: "Google Maps",
                severity: "medium",
                timestamp: new Date(Date.now() - 10 * 60000).toISOString(),
                coordinates: [19.4350, -99.1470],
                confirmed: true,
                realTime: true
            }
        ];

        // ===== APIS SIMULADAS =====
        const SIMULATED_APIS = {
            // Simulaci√≥n de datos de OpenStreetMap
            osm: async () => {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const data = [
                            {
                                id: "osm-1",
                                type: "infraestructura",
                                location: "Paseo de la Reforma",
                                description: "Obras viales por mantenimiento",
                                source: "OpenStreetMap",
                                severity: "medium",
                                timestamp: new Date().toISOString(),
                                coordinates: [19.4330, -99.1520],
                                confirmed: true,
                                realTime: true
                            }
                        ];
                        resolve(data);
                    }, 1500);
                });
            },

            // Simulaci√≥n de datos de noticias
            news: async () => {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const data = [
                            {
                                id: "news-1",
                                type: "noticia",
                                location: "CDMX Centro",
                                description: "Transportistas anuncian megamarcha para este mi√©rcoles",
                                source: "Google News",
                                severity: "medium",
                                timestamp: new Date().toISOString(),
                                coordinates: [19.4300, -99.1500],
                                confirmed: true,
                                realTime: true
                            }
                        ];
                        resolve(data);
                    }, 2000);
                });
            },

            // Simulaci√≥n de datos de tr√°fico
            traffic: async () => {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const data = [
                            {
                                id: "traffic-1",
                                type: "trafico",
                                location: "Eje Central L√°zaro C√°rdenas",
                                description: "Tr√°fico pesado por manifestaci√≥n",
                                source: "Waze",
                                severity: "high",
                                timestamp: new Date().toISOString(),
                                coordinates: [19.4310, -99.1475],
                                confirmed: true,
                                realTime: true
                            }
                        ];
                        resolve(data);
                    }, 1000);
                });
            }
        };

        // ===== INICIALIZACI√ìN =====
        function initializeApp() {
            initMap();
            updateClock();
            setInterval(updateClock, 1000);
            loadSimulatedData();
        }

        // ===== CARGA DE DATOS SIMULADOS =====
        async function loadSimulatedData() {
            updateStatus('Consultando fuentes reales...', 'loading');
            updateLoadingText('Buscando datos en 1.5 km del √Ångel', 'OpenStreetMap + Google News + Tr√°fico');
            
            try {
                // Simular carga de datos de APIs
                const [osmData, newsData, trafficData] = await Promise.all([
                    SIMULATED_APIS.osm(),
                    SIMULATED_APIS.news(),
                    SIMULATED_APIS.traffic()
                ]);

                // Combinar datos simulados de APIs con datos de manifestaci√≥n
                const allData = [...SIMULATED_DATA, ...osmData, ...newsData, ...trafficData];
                processRealData(allData);
                updateStatus(`${allData.length} elementos encontrados`, 'success');
                
            } catch (error) {
                console.error('Error:', error);
                updateStatus('Error de conexi√≥n', 'error');
                showNoDataMessage();
            }
        }

        // ===== PROCESAMIENTO =====
        function processRealData(data) {
            updateCounters(data);
            updateRealMap(data);
            updateRealList(data);
            updateUI(data);
        }

        // ===== INTERFAZ =====
        function updateStatus(message, type = 'success') {
            const statusElement = document.getElementById('status-text');
            const statusContainer = document.getElementById('status-container');
            
            if (statusElement) statusElement.textContent = message;
            
            const colors = {
                loading: 'bg-yellow-500',
                success: 'bg-green-500',
                error: 'bg-red-500'
            };
            
            if (statusContainer) {
                statusContainer.className = `inline-flex items-center px-3 py-1 rounded-full text-sm ${colors[type]} text-white ml-2`;
            }
        }

        function updateLoadingText(mainText, subText) {
            const mainElement = document.getElementById('loading-text');
            const subElement = document.getElementById('loading-subtext');
            
            if (mainElement) mainElement.textContent = mainText;
            if (subElement) subElement.textContent = subText;
        }

        function updateCounters(data) {
            document.getElementById('active-count').textContent = data.filter(d => d.severity === 'high').length;
            document.getElementById('reports-count').textContent = data.length;
            document.getElementById('total-count').textContent = data.length;
            document.getElementById('sources-count').textContent = new Set(data.map(item => item.source)).size;
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString('es-MX');
        }

        function updateRealMap(data) {
            if (!map) return;
            
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
            
            // Marcador del √Ångel
            const angelIcon = L.divIcon({
                html: `<div class="pulse-dot" style="background: #3b82f6; width: 32px; height: 32px; border-radius: 50%; border: 4px solid white; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.5);"></div>`,
                iconSize: [32, 32],
                iconAnchor: [16, 16]
            });

            L.marker(ANGEL_COORDS, { icon: angelIcon })
                .addTo(map)
                .bindPopup('<div class="p-2"><h3 class="font-bold">√Ångel de la Independencia</h3><p class="text-sm">Centro del √°rea de monitoreo</p></div>');

            // Dibujar pines de calles afectadas
            if (affectedStreetsLayer) {
                map.removeLayer(affectedStreetsLayer);
            }
            
            affectedStreetsLayer = L.layerGroup().addTo(map);
            
            AFFECTED_STREETS.forEach(street => {
                const streetIcon = L.divIcon({
                    html: `<div class="street-pin" style="width: 30px; height: 30px;"></div>`,
                    iconSize: [30, 30],
                    iconAnchor: [15, 30]
                });
                
                const marker = L.marker(street.coords, { icon: streetIcon })
                    .addTo(affectedStreetsLayer)
                    .bindPopup(`
                        <div class="p-3 min-w-[280px]">
                            <h3 class="font-bold text-lg mb-2 text-red-600">${street.name}</h3>
                            <p class="text-sm text-gray-700 mb-3">Vialidad afectada por la megamarcha de transportistas</p>
                            <div class="space-y-1 text-xs">
                                <div class="flex justify-between">
                                    <span class="font-semibold">Horario:</span>
                                    <span>14:00 - 19:00 hrs</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-semibold">Estado:</span>
                                    <span class="text-red-500 font-semibold">${street.type === 'bloqueo-total' ? 'Bloqueo total' : 'Bloqueo parcial'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-semibold">Tipo:</span>
                                    <span>Megamarcha transportistas</span>
                                </div>
                            </div>
                        </div>
                    `);
                
                markers.push(marker);
            });

            // Marcadores de incidentes
            data.forEach(item => {
                let icon;
                
                if (item.type === 'manifestacion') {
                    icon = L.divIcon({
                        html: `<div class="traffic-pin" style="width: 24px; height: 24px;"></div>`,
                        iconSize: [24, 24],
                        iconAnchor: [12, 12]
                    });
                } else {
                    const color = item.severity === 'high' ? 'red' : 
                                 item.severity === 'medium' ? 'orange' : 'blue';
                    
                    icon = L.divIcon({
                        html: `<div style="background: ${color}; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);"></div>`,
                        iconSize: [20, 20],
                        iconAnchor: [10, 10]
                    });
                }
                
                const marker = L.marker(item.coordinates, { icon })
                    .addTo(map)
                    .bindPopup(`
                        <div class="p-3 min-w-[280px]">
                            <h3 class="font-bold text-lg mb-2">${item.location}</h3>
                            <p class="text-sm text-gray-700 mb-3">${item.description}</p>
                            <div class="space-y-1 text-xs">
                                <div class="flex justify-between">
                                    <span class="font-semibold">Fuente:</span>
                                    <span>${item.source}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-semibold">Tipo:</span>
                                    <span class="capitalize">${item.type}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="font-semibold">Hora:</span>
                                    <span>${new Date(item.timestamp).toLocaleTimeString()}</span>
                                </div>
                            </div>
                        </div>
                    `);
                
                markers.push(marker);
            });
            
            // Ajustar vista para mostrar el √°rea completa
            if (data.length > 0 || AFFECTED_STREETS.length > 0) {
                const group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));
            } else {
                map.setView(ANGEL_COORDS, 15);
            }
        }

        function updateRealList(data) {
            const list = document.getElementById('reports-list');
            if (!list) return;
            
            if (data.length === 0) {
                list.innerHTML = `
                    <div class="text-center p-8 text-gray-400">
                        <i data-lucide="check-circle" class="w-16 h-16 mx-auto mb-4 text-green-400"></i>
                        <p class="text-xl">Sin incidentes reportados</p>
                        <p class="text-sm text-gray-500 mt-2">No se encontraron eventos en el √°rea monitoreada</p>
                        <div class="mt-4 p-4 bg-green-500/20 rounded-lg border border-green-500">
                            <p class="text-green-400 text-sm">√Årea de 1.5 km alrededor del √Ångel</p>
                            <p class="text-green-400 text-sm">Fuentes: OpenStreetMap + Google News</p>
                        </div>
                    </div>
                `;
            } else {
                list.innerHTML = data.map(item => `
                    <div class="p-4 rounded-lg border-l-4 ${
                        item.severity === 'high' ? 'border-red-500 bg-red-500/10' : 
                        item.severity === 'medium' ? 'border-orange-500 bg-orange-500/10' : 
                        'border-blue-500 bg-blue-500/10'
                    }">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <h3 class="font-semibold text-lg">${item.location}</h3>
                                    <span class="ml-2 px-2 py-1 ${
                                        item.severity === 'high' ? 'bg-red-500' : 
                                        item.severity === 'medium' ? 'bg-orange-500' : 
                                        'bg-blue-500'
                                    } text-white rounded-full text-xs font-medium">
                                        ${item.source}
                                    </span>
                                </div>
                                <p class="text-gray-300">${item.description}</p>
                                <div class="flex items-center mt-2 text-sm text-gray-400">
                                    <i data-lucide="clock" class="w-4 h-4 mr-1"></i>
                                    <span>${new Date(item.timestamp).toLocaleString('es-MX')}</span>
                                    <span class="mx-2">‚Ä¢</span>
                                    <i data-lucide="map-pin" class="w-4 h-4 mr-1"></i>
                                    <span>${item.type}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            lucide.createIcons();
        }

        function updateUI(data) {
            updateLoadingText(
                data.length > 0 ? `${data.length} elementos en el √°rea` : 'Monitoreo activo',
                data.length > 0 ? 'Radio de 1.5 km del √Ångel' : 'Buscando datos reales'
            );
        }

        function showNoDataMessage() {
            const list = document.getElementById('reports-list');
            if (list) {
                list.innerHTML = `
                    <div class="text-center p-8 text-gray-400">
                        <i data-lucide="wifi-off" class="w-16 h-16 mx-auto mb-4 text-red-400"></i>
                        <p class="text-xl text-red-400">Fuentes no disponibles</p>
                        <p class="text-sm text-gray-500 mt-2">No se pudieron conectar a las APIs en este momento</p>
                    </div>
                `;
                lucide.createIcons();
            }
        }

        function initMap() {
            const mapElement = document.getElementById('map');
            if (!mapElement) return;
            
            map = L.map('map').setView(ANGEL_COORDS, 15);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);

            // Dibujar c√≠rculo de 1.5 km
            L.circle(ANGEL_COORDS, {
                color: '#3b82f6',
                fillColor: '#3b82f6',
                fillOpacity: 0.1,
                radius: SEARCH_RADIUS * 1000
            }).addTo(map).bindPopup('√Årea de monitoreo: 1.5 km');
        }

        function updateClock() {
            const clock = document.getElementById('real-time-clock');
            if (clock) {
                clock.textContent = new Date().toLocaleTimeString('es-MX');
            }
        }

        // ===== INICIALIZACI√ìN =====
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            initializeApp();
            
            // Actualizar cada 2 minutos
            setInterval(loadSimulatedData, 2 * 60 * 1000);
        });

    </script>
</body>
</html>
