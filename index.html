<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reforma Segura - Monitoreo en Tiempo Real</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            color: white;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
            background: #000000;
        }

        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: 
                radial-gradient(circle at 20% 80%, rgba(220, 38, 38, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(220, 38, 38, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(239, 68, 68, 0.05) 0%, transparent 50%),
                linear-gradient(135deg, #000000 0%, #0a0a0a 50%, #000000 100%);
        }

        .floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .floating-element {
            position: absolute;
            background: linear-gradient(45deg, #dc2626, #ef4444);
            border-radius: 50%;
            filter: blur(40px);
            opacity: 0.3;
            animation: floatElement 15s infinite linear;
        }

        .floating-element:nth-child(1) {
            width: 300px;
            height: 300px;
            top: 10%;
            left: 10%;
            animation-delay: 0s;
            animation-duration: 20s;
        }

        .floating-element:nth-child(2) {
            width: 200px;
            height: 200px;
            top: 60%;
            left: 80%;
            animation-delay: 5s;
            animation-duration: 25s;
        }

        .floating-element:nth-child(3) {
            width: 400px;
            height: 400px;
            top: 80%;
            left: 20%;
            animation-delay: 10s;
            animation-duration: 30s;
        }

        .floating-element:nth-child(4) {
            width: 250px;
            height: 250px;
            top: 20%;
            left: 70%;
            animation-delay: 15s;
            animation-duration: 18s;
        }

        .floating-element:nth-child(5) {
            width: 350px;
            height: 350px;
            top: 50%;
            left: 40%;
            animation-delay: 7s;
            animation-duration: 22s;
        }

        @keyframes floatElement {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 0.2;
            }
            25% {
                transform: translate(100px, 50px) scale(1.1);
                opacity: 0.3;
            }
            50% {
                transform: translate(200px, -30px) scale(0.9);
                opacity: 0.25;
            }
            75% {
                transform: translate(50px, -80px) scale(1.05);
                opacity: 0.35;
            }
            100% {
                transform: translate(0, 0) scale(1);
                opacity: 0.2;
            }
        }

        .grid-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background-image: 
                linear-gradient(rgba(220, 38, 38, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(220, 38, 38, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
        }

        @keyframes gridMove {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 50px 50px;
            }
        }
        
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
            
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }
        
        #map-container {
            height: 60vh;
            width: 100%;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: #1a1a1a;
        }
        
        .card {
            background: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #dc2626, #ef4444);
            border-radius: 16px 16px 0 0;
        }
        
        .affected-street {
            position: relative;
            padding-left: 20px;
        }
        
        .affected-street::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background-color: #ef4444;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .alert-banner {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.2) 0%, rgba(239, 68, 68, 0.1) 100%);
            border: 1px solid rgba(220, 38, 38, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .glow {
            box-shadow: 0 0 30px rgba(220, 38, 38, 0.3);
        }
        
        /* Pines mejorados sin fondo blanco */
        .custom-pin {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            position: relative;
            /* Eliminar cualquier fondo blanco */
            background: transparent !important;
        }
        
        .pin-pulse {
            animation: pinPulse 2s infinite;
        }
        
        @keyframes pinPulse {
            0% {
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7);
            }
            70% {
                box-shadow: 0 0 0 12px rgba(220, 38, 38, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0);
            }
        }
        
        .loading-bar {
            height: 4px;
            background: linear-gradient(90deg, #dc2626, #ef4444, #f59e0b);
            border-radius: 2px;
            animation: loading 2s infinite;
            width: 100%;
        }
        
        @keyframes loading {
            0% {
                background-position: -200px 0;
            }
            100% {
                background-position: calc(200px + 100%) 0;
            }
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0% {
                transform: translate(0, 0px);
            }
            50% {
                transform: translate(0, -10px);
            }
            100% {
                transform: translate(0, 0px);
            }
        }

        .title-glow {
            text-shadow: 0 0 30px rgba(239, 68, 68, 0.5);
        }
    </style>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="p-4 md:p-8 min-h-screen">
    <!-- Fondo negro con elementos rojos -->
    <div class="grid-pattern"></div>
    <div class="background-animation"></div>
    <div class="floating-elements">
        <div class="floating-element"></div>
        <div class="floating-element"></div>
        <div class="floating-element"></div>
        <div class="floating-element"></div>
        <div class="floating-element"></div>
    </div>

    <div class="max-w-7xl mx-auto relative z-10">
        <header class="mb-8 text-center">
            <h1 class="text-4xl md:text-6xl font-extrabold bg-gradient-to-r from-red-400 to-red-600 bg-clip-text text-transparent mt-4 floating title-glow">
                Reforma Segura
            </h1>
            <p class="text-lg md:text-xl text-gray-300 mt-2 max-w-3xl mx-auto">
                Monitoreo en Tiempo Real - Megamarcha Transportistas
                <span id="status-container" class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-red-600 text-white ml-2">
                    <i data-lucide="alert-triangle" class="w-3 h-3 mr-1"></i>
                    <span id="status-text">Conectando...</span>
                </span>
            </p>
            <div class="mt-4">
                <div class="text-lg bg-gray-900 rounded-lg px-4 py-2 inline-block border border-gray-700" id="real-time-clock">--:--:--</div>
            </div>
        </header>

        <!-- Banner informativo sobre la megamarcha -->
        <div class="card p-6 mb-6 alert-banner glow">
            <div class="flex items-start">
                <div class="mr-4 mt-1">
                    <i data-lucide="alert-triangle" class="w-8 h-8 text-red-400"></i>
                </div>
                <div class="flex-1">
                    <h2 class="text-xl font-bold mb-2">🚨 Megamarcha de Transportistas ACTIVA - Miércoles 29 de octubre de 2025</h2>
                    <p class="mb-3 text-gray-200">La <strong class="text-red-300">Fuerza Amplia de Transportistas (FAT)</strong> está realizando una megamarcha y bloqueos masivos exigiendo un aumento en las tarifas del transporte público.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h3 class="font-semibold mb-2 text-red-300">Detalles de la manifestación:</h3>
                            <ul class="text-sm space-y-1 text-gray-300">
                                <li><strong>Horario:</strong> 14:00 - 19:00 horas</li>
                                <li><strong>Recorrido:</strong> Del Monumento a la Revolución al Zócalo Capitalino</li>
                                <li><strong>Inicio:</strong> 15:00 horas desde el Monumento a la Revolución</li>
                                <li><strong>Organizador:</strong> Movimiento "Recuperemos el Régimen de Jubilaciones y Pensiones"</li>
                                <li><strong>Estado actual:</strong> <span class="text-red-300 font-bold">EN CURSO</span></li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="font-semibold mb-2 text-red-300">Vialidades afectadas:</h3>
                            <ul class="text-sm space-y-1 text-gray-300">
                                <li class="affected-street">Avenida de la República</li>
                                <li class="affected-street">Paseo de la Reforma</li>
                                <li class="affected-street">Calle Balderas</li>
                                <li class="affected-street">Avenida Juárez</li>
                                <li class="affected-street">Eje Central Lázaro Cárdenas</li>
                                <li class="affected-street">Avenida Hidalgo</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-3 bg-red-500/20 rounded-lg border border-red-500">
                        <h3 class="font-semibold mb-1 text-red-300">Recomendaciones:</h3>
                        <p class="text-sm text-gray-200">Evite el uso de vehículos particulares en las zonas afectadas. Utilice rutas alternas como Periférico, Circuito Interior o Viaducto Miguel Alemán.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resto del contenido se mantiene igual -->
        <div class="card p-4 mb-6 bg-blue-500/10 border border-blue-500">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i data-lucide="map-pin" class="w-5 h-5 text-blue-400"></i>
                    <div>
                        <p class="font-semibold">Área de Monitoreo: 1.5 km alrededor del Ángel</p>
                        <p class="text-sm text-gray-400">Incluye: Reforma, Zona Rosa, Condesa, Juárez</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-sm font-mono">19.4269, -99.1678</p>
                    <p class="text-xs text-gray-400">Coordenadas exactas</p>
                </div>
            </div>
        </div>

        <div class="card p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-white flex items-center">
                <i data-lucide="activity" class="w-6 h-6 mr-2 text-red-400"></i>
                Estado del Área - Tiempo Real
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-gradient-to-br from-red-500 to-red-600 p-4 rounded-xl text-white">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm opacity-90">Incidentes Activos</p>
                            <p class="text-2xl font-bold" id="active-count">8</p>
                        </div>
                        <i data-lucide="alert-triangle" class="w-8 h-8"></i>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-orange-500 to-orange-600 p-4 rounded-xl text-white">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm opacity-90">Reportes Ciudadanos</p>
                            <p class="text-2xl font-bold" id="reports-count">24</p>
                        </div>
                        <i data-lucide="users" class="w-8 h-8"></i>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-4 rounded-xl text-white">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm opacity-90">Fuentes Activas</p>
                            <p class="text-2xl font-bold" id="sources-count">3</p>
                        </div>
                        <i data-lucide="radio" class="w-8 h-8"></i>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-green-500 to-green-600 p-4 rounded-xl text-white">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm opacity-90">Última Actualización</p>
                            <p class="text-lg font-bold" id="last-update">--:--</p>
                        </div>
                        <i data-lucide="clock" class="w-8 h-8"></i>
                    </div>
                </div>
            </div>
        </div>

        <div id="map-container" class="mb-8">
            <div id="map" class="w-full h-full"></div>
        </div>

        <section class="card p-6">
            <h2 class="text-2xl font-semibold mb-4 text-white flex items-center">
                <i data-lucide="alert-circle" class="w-6 h-6 mr-2 text-orange-400"></i>
                Reportes Reales del Área
                <span class="absolute top-0 right-0 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs -mt-2 -mr-2" id="total-count">8</span>
            </h2>
            <div id="reports-list" class="space-y-4">
                <!-- Los reportes se cargarán aquí -->
            </div>
        </section>

        <!-- Fuentes de datos reales -->
        <div class="card p-4 mt-8">
            <h3 class="text-lg font-semibold mb-3 text-white">Fuentes de Datos Activas</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                <div class="flex items-center space-x-2 p-3 bg-blue-500/10 rounded-lg border border-blue-500">
                    <i data-lucide="map" class="w-4 h-4 text-blue-400"></i>
                    <span>OpenStreetMap - Datos de construcción</span>
                </div>
                <div class="flex items-center space-x-2 p-3 bg-green-500/10 rounded-lg border border-green-500">
                    <i data-lucide="rss" class="w-4 h-4 text-green-400"></i>
                    <span>Google News CDMX - Noticias locales</span>
                </div>
                <div class="flex items-center space-x-2 p-3 bg-red-500/10 rounded-lg border border-red-500">
                    <i data-lucide="radio" class="w-4 h-4 text-red-400"></i>
                    <span>Secretaría de Movilidad CDMX</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== CONFIGURACIÓN =====
        const ANGEL_COORDS = [19.4269, -99.1678];
        const SEARCH_RADIUS = 1.5;
        let map;
        let markers = [];

        // ===== FUNCIONES PARA CREAR PINES MEJORADOS (SIN FONDO BLANCO) =====
        function createManifestationPin() {
            return L.divIcon({
                html: `
                    <div class="custom-pin pin-pulse" style="width: 40px; height: 40px; background: #dc2626 !important;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                    </div>
                `,
                iconSize: [40, 40],
                iconAnchor: [20, 40],
                popupAnchor: [0, -40],
                className: 'custom-pin-container' // Clase adicional para evitar estilos por defecto
            });
        }

        function createTrafficPin() {
            return L.divIcon({
                html: `
                    <div class="custom-pin pin-pulse" style="width: 36px; height: 36px; background: #f59e0b !important;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
                            <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z"/>
                        </svg>
                    </div>
                `,
                iconSize: [36, 36],
                iconAnchor: [18, 36],
                popupAnchor: [0, -36],
                className: 'custom-pin-container'
            });
        }

        function createAngelPin() {
            return L.divIcon({
                html: `
                    <div class="custom-pin pulse-dot" style="width: 44px; height: 44px; background: #3b82f6 !important;">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="white">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                    </div>
                `,
                iconSize: [44, 44],
                iconAnchor: [22, 44],
                popupAnchor: [0, -44],
                className: 'custom-pin-container'
            });
        }

        // El resto del JavaScript se mantiene igual...
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            // Inicializar la aplicación
            updateStatus('Sistema activo', 'success');
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString('es-MX');
            updateClock();
            setInterval(updateClock, 1000);
        });

        function updateStatus(message, type = 'success') {
            const statusElement = document.getElementById('status-text');
            const statusContainer = document.getElementById('status-container');
            
            if (statusElement) statusElement.textContent = message;
            
            const colors = {
                loading: 'bg-yellow-500',
                success: 'bg-green-500',
                error: 'bg-red-500'
            };
            
            if (statusContainer) {
                statusContainer.className = `inline-flex items-center px-3 py-1 rounded-full text-sm ${colors[type]} text-white ml-2`;
            }
        }

        function updateClock() {
            const clock = document.getElementById('real-time-clock');
            if (clock) {
                clock.textContent = new Date().toLocaleTimeString('es-MX');
            }
        }
    </script>
</body>
</html>
